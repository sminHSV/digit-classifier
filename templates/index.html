<!DOCTYPE html>
<html>
<head>
    <title></title>
    <style>
        canvas {
            border: 1px solid black;
        }
    </style>
</head>
<body>
    <div style="
        display: grid;
        grid-template-columns: 1fr auto auto 1fr;
        grid-gap: 20px;
    ">
        <div style="grid-column: 2">
            <h1>Draw a digit:</h1>
            <canvas id="canvas" width="600" height="600"></canvas>
            <br>
            <button id="clear" style="font-size: 20px">clear</button>
            <button id="submit" style="font-size: 20px">submit</button>
            <label for="lineWidth"  style="font-size: 20px">Line Width</label>
            <input type="range" id="lineWidth" min="5" max="100" value="30">
        </div>
        <div style="grid-column: 3;text-align: center;">
            <h1>You Entered:</h1>
            <span id="result" style="font-size: 50px;">5</span>
        </div>
    </div>
</body>

<script type="text/javascript">
canvas = document.getElementById('canvas');
clear = document.getElementById('clear');
submit = document.getElementById('submit');
ctx = canvas.getContext("2d");

ctx.fillStyle = "white";
ctx.fillRect(0, 0, canvas.width, canvas.height);

lineWidth = document.getElementById("lineWidth");

prev_x = 0;
prev_y = 0;

mousedown = false;

function getMousePos(canvas, evt) {
    var rect = canvas.getBoundingClientRect();
    return {
      x: evt.clientX - rect.left,
      y: evt.clientY - rect.top
    };
  }

canvas.addEventListener("mousemove", function (e) {
    pos = getMousePos(canvas, e);
    if (mousedown) {
        draw(pos.x, pos.y, prev_x, prev_y);
    }
    prev_x = pos.x;
    prev_y = pos.y;
}, false);
canvas.addEventListener("mousedown", function (e) {
    mousedown = true;
    pos = getMousePos(canvas, e);
    draw(pos.x, pos.y, pos.x, pos.y);
}, false);
canvas.addEventListener("mouseup", function (e) {
    mousedown = false;
}, false);
canvas.addEventListener("mouseout", function (e) {
    mousedown = false;
}, false);

function draw(x2, y2, x1, y1) {
    width = lineWidth.value;
    length = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));

    for (var t = 0; t <= length; t += 5) {
        x = x1 + (t / length) * (x2 - x1);
        y = y1 + (t / length) * (y2 - y1);
        ctx.fillStyle = "black";
        ctx.beginPath();
        ctx.arc(x, y, width/2, 0, Math.PI * 2);
        ctx.fill();
    }
}

clear.addEventListener("click", function (e) {
    document.getElementById("result").innerHTML = "";
    ctx.fillStyle = "white";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
}, false);

submit.addEventListener("click", function (e) {
    document.getElementById("result").innerHTML = "...";

    var image = canvas.toDataURL("image/jpeg", 1.0);
    url = {{ url_for('predict')|tojson }};

    fetch(url, {
        method: 'POST',
        body: JSON.stringify({
            image: image
        }),
        headers: {
            'Content-Type': 'application/json'
        }
    }).then(function (response) {
        return response.json();
    }).then(function (json) {
        document.getElementById("result").innerHTML = json.result;
    });
}, false);
</script>

</html>
